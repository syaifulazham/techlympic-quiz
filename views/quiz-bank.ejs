
<script src="https://code.jquery.com/jquery-3.7.0.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>

<div class="panel flex-row width-full">
    <div class="panel-side flex-column">
        <div class="search-panel flex-row"></div>
        <div class="search-panel flex-row"></div>
        <div class="label">Theme</div>
        <div class="field-area">
            <select name="qtheme" id="qtheme">
                <option value=""></option>
                <option value="Bahasa">Bahasa</option>
                <option value="Dunia">Dunia</option>
                <option value="Kejuruteraan">Kejuruteraan</option>
                <option value="Matematik">Matematik</option>
                <option value="Sains">Sains</option>
                <option value="Teknologi">Teknologi</option>
                <option value="Umum">Umum</option>
            </select>
        </div>
        <div class="label">Category</div>
        <div class="field-area">
            <select name="qcategory" id="qcategory">
                <option value=""></option>
            </select>
        </div>
        <div class="label">Question Type</div>
        <div class="field-area">
            <select name="qtype" id="qtype">
                <option value="Text">Text</option>
                <option value="Picture">Picture</option>
            </select>
        </div>
        <div class="label">Question</div>
        <div class="field-area">
            <div id="question" contenteditable="true" class="message"></div>
        </div>
        <div class="label flex-row">Answer Choice 1 <div class="float-right"><label for="correct1">Correct Answer</label><input id="correct1" value="1" type="radio" name="correct"></div></div>
        <div class="field-area">
            <div id="opt1" contenteditable="true" class="message"></div>
        </div>
        <div class="label flex-row">Answer Choice 2 <div class="float-right"><label for="correct2">Correct Answer</label><input id="correct2" value="2" type="radio" name="correct"></div></div>
        <div class="field-area">
            <div id="opt2" contenteditable="true" class="message"></div>
        </div>
        <div class="label flex-row">Answer Choice 3 <div class="float-right"><label for="correct3">Correct Answer</label><input id="correct3" value="3" type="radio" name="correct"></div></div>
        <div class="field-area">
            <div id="opt3" contenteditable="true" class="message"></div>
        </div>
        <div class="label flex-row">Answer Choice 4 <div class="float-right"><label for="correct4">Correct Answer</label><input id="correct4" value="4" type="radio" name="correct"></div></div>
        <div class="field-area">
            <div id="opt4" contenteditable="true" class="message"></div>
        </div>
        <div class="field-area flex-row center">
            <div id="addQuestion" class="button float-right" onclick="doSave()">Add</div>
        </div>
    </div>
    <div class="panel-body flex-column">
        <div class="search-panel flex-row">
            <input type="text">
            <div class="menu">Search</div>
        </div>
        <table class="table">
            <thead>
                <tr>
                    <th>Theme</th>
                    <th>Sub Theme</th>
                    <th>Question</th>
                    <th>Options</th>
                    <th>Correct Answer</th>
                </tr>
            </thead>
            <tbody>
                <%data.forEach(d=>{%>
                    <tr>
                        <td><%=d.theme%></td>
                        <td><%=d.sub_theme%></td>
                        <td><%=d.question%></td>
                        <td><%=d.objective_options%></td>
                        <td><%=d.correct_answer%></td>
                    </tr>
                <%})%>
            </tbody>
        </table>
    </div>
</div>

<script>
    var API = {
        action: {
            add: (data, fn)=>{
                $.ajax({
                    type: 'POST',
                    url: '/api/quiz/addquestion',
                    data: {data:data},
                    dataType: 'json',
                    success: (result)=>{
                        fn(result);
                    }
                })
            }
        }
    }

    var doSave = ()=>{
        n = $('input[name="correct"]:checked').val();
        compile = {
            qtype: $('#qtype').val(),
            theme: $('#qtheme').val(),
            sub_theme: $('#qcategory').val(),
            question: $('#question').text(),
            objective_options: [$('#opt1').text(),$('#opt2').text(),$('#opt3').text(),$('#opt4').text()].join('|'),
            correct_answer: $('#opt' + n).text()
        }

        data = [
            compile.qtype,
            compile.theme,
            compile.sub_theme,
            compile.question,
            compile.objective_options,
            compile.correct_answer
        ]
        console.log(data);

        API.action.add(data, result=>{
            window.location.href = "/quiz-bank";
        });

    }
</script>